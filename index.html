<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>シンプル掲示板（2ちゃん風）</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  :root {
    --link-color: #0066cc;
    --border-color: #ddd;
    --bg-light: #f7f7f7;
  }

  * { box-sizing: border-box; }

  body {
    margin: 0;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    background: #ffffff;
    color: #000000;
  }

  a {
    color: var(--link-color);
    text-decoration: none;
  }
  a:hover {
    text-decoration: underline;
  }

  header {
    position: sticky;
    top: 0;
    z-index: 10;
    background: #fff;
    border-bottom: 1px solid var(--border-color);
    padding: 8px 12px;
  }

  header h1 {
    margin: 0;
    font-size: 20px;
  }
  header small {
    color: #666;
    font-size: 11px;
  }

  main {
    display: flex;
    gap: 8px;
    padding: 8px;
  }

  /* レイアウト（PC） */
  .thread-list {
    flex: 0 0 260px;
    border: 1px solid var(--border-color);
    background: var(--bg-light);
    padding: 8px;
    max-height: calc(100vh - 70px);
    overflow-y: auto;
  }

  .thread-list h2 {
    margin-top: 0;
    font-size: 14px;
    border-bottom: 1px solid var(--border-color);
    padding-bottom: 4px;
  }

  .thread-item {
    padding: 4px 6px;
    border-radius: 3px;
    cursor: pointer;
    font-size: 13px;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  .thread-item span.title {
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    max-width: 180px;
  }
  .thread-item span.count {
    font-size: 11px;
    color: #666;
  }
  .thread-item:hover {
    background: #e8f2ff;
  }
  .thread-item.active {
    background: #d9e8ff;
  }

  .new-thread {
    margin-top: 8px;
    padding-top: 8px;
    border-top: 1px dashed var(--border-color);
  }
  .new-thread label {
    display: block;
    font-size: 11px;
    margin-top: 4px;
  }
  .new-thread input,
  .new-thread textarea {
    width: 100%;
    font-size: 12px;
    padding: 4px;
    margin-top: 2px;
  }
  .new-thread textarea {
    min-height: 60px;
    resize: vertical;
  }

  button {
    font-size: 12px;
    padding: 4px 8px;
    margin-top: 6px;
    border: 1px solid var(--border-color);
    background: #fff;
    cursor: pointer;
  }
  button:hover {
    background: #e8f2ff;
  }

  /* スレ本文側 */
  .thread-view {
    flex: 1;
    border: 1px solid var(--border-color);
    padding: 8px;
    min-height: calc(100vh - 70px);
    overflow-y: auto;
  }

  .thread-view h2 {
    margin: 0 0 4px;
    font-size: 16px;
  }

  .thread-meta {
    font-size: 11px;
    color: #666;
    margin-bottom: 8px;
  }

  .posts {
    border-top: 1px solid var(--border-color);
    padding-top: 8px;
    margin-top: 8px;
    font-family: "Courier New", monospace;
    font-size: 13px;
    line-height: 1.4;
  }

  .post {
    padding: 4px 0;
    border-bottom: 1px dotted #ccc;
  }

  .post-header {
    color: #555;
    margin-bottom: 2px;
  }
  .post-header span.num {
    font-weight: bold;
  }
  .post-header span.name {
    color: #006600;
  }
  .post-header span.date {
    font-size: 11px;
  }

  .post-body {
    white-space: pre-wrap;
  }

  .new-post {
    margin-top: 10px;
    border-top: 1px solid var(--border-color);
    padding-top: 8px;
  }
  .new-post label {
    display: block;
    font-size: 11px;
    margin-top: 4px;
  }
  .new-post input,
  .new-post textarea {
    width: 100%;
    font-size: 12px;
    padding: 4px;
    margin-top: 2px;
  }
  .new-post textarea {
    min-height: 80px;
    resize: vertical;
  }

  .notice {
    font-size: 11px;
    color: #777;
    margin-top: 4px;
  }

  footer {
    text-align: center;
    font-size: 11px;
    color: #777;
    padding: 8px;
    border-top: 1px solid var(--border-color);
  }

  /* スマホ用 */
  @media (max-width: 768px) {
    main {
      flex-direction: column;
    }
    .thread-list {
      max-height: none;
      order: 1;
    }
    .thread-view {
      order: 2;
      min-height: auto;
    }
  }
</style>
</head>
<body>

<header>
  <h1>おじちゃんねる <small>（ローカル掲示板）</small></h1>
  <small>※書き込みはこのブラウザの中だけに保存されます（localStorage）</small>
</header>

<main>
  <!-- スレ一覧 -->
  <aside class="thread-list">
    <h2>スレッド一覧</h2>
    <div id="threadList"></div>

    <div class="new-thread">
      <strong>新規スレッド作成</strong>
      <label>スレタイ：
        <input type="text" id="newThreadTitle" placeholder="例）雑談スレ part1">
      </label>
      <label>本文（1レス目）：
        <textarea id="newThreadBody" placeholder="スレ立ての本文を書いてください"></textarea>
      </label>
      <button id="createThreadBtn">スレ立て</button>
      <div class="notice">※すべてブラウザ内に保存されます。</div>
    </div>
  </aside>

  <!-- スレ本文 -->
  <section class="thread-view">
    <div id="threadViewInner">
      <p>左のリストからスレッドを選ぶか、新しくスレッドを立ててください。</p>
    </div>
  </section>
</main>

<footer>
  © 2025 おじちゃんねる（なんちゃって2ちゃん風ローカル掲示板）
</footer>

<script>
  // ===== データ構造 =====
  // threads: [{ id, title, createdAt, posts: [{name, body, createdAt}] }]
  const STORAGE_KEY = "simpleBBSData_v1";

  let state = {
    threads: [],
    activeThreadId: null,
  };

  // ==== 初期データ ====
  const defaultData = {
    threads: [
      {
        id: "t1",
        title: "雑談スレ part1",
        createdAt: new Date().toISOString(),
        posts: [
          {
            name: "名無しさん",
            body: "雑談はこちらでどうぞ。\nのんびりやっていきましょう。",
            createdAt: new Date().toISOString()
          }
        ]
      },
      {
        id: "t2",
        title: "ニュース総合スレ",
        createdAt: new Date().toISOString(),
        posts: [
          {
            name: "名無しさん",
            body: "最近気になったニュースを貼っていくスレ。",
            createdAt: new Date().toISOString()
          }
        ]
      },
      {
        id: "t3",
        title: "ネタ・コピペスレ",
        createdAt: new Date().toISOString(),
        posts: [
          {
            name: "名無しさん",
            body: "好きなネタやコピペを貼っていく場所です。",
            createdAt: new Date().toISOString()
          }
        ]
      }
    ],
    activeThreadId: "t1"
  };

  // ===== localStorage 読み込み =====
  function loadState() {
    try {
      const raw = localStorage.getItem(STORAGE_KEY);
      if (!raw) {
        state = defaultData;
        saveState();
      } else {
        state = JSON.parse(raw);
        // 古いバージョン対策とかあればここで
      }
    } catch (e) {
      console.error("load error", e);
      state = defaultData;
    }
  }

  function saveState() {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
  }

  // ===== ユーティリティ =====
  function formatDate(iso) {
    const d = new Date(iso);
    const pad = (n) => String(n).padStart(2, "0");
    return (
      d.getFullYear() + "/" +
      pad(d.getMonth() + 1) + "/" +
      pad(d.getDate()) + " " +
      pad(d.getHours()) + ":" +
      pad(d.getMinutes())
    );
  }

  function findThread(id) {
    return state.threads.find(t => t.id === id);
  }

  // ===== DOM要素 =====
  const threadListEl = document.getElementById("threadList");
  const threadViewInner = document.getElementById("threadViewInner");
  const newThreadTitleEl = document.getElementById("newThreadTitle");
  const newThreadBodyEl = document.getElementById("newThreadBody");
  const createThreadBtn = document.getElementById("createThreadBtn");

  // ===== スレ一覧の描画 =====
  function renderThreadList() {
    threadListEl.innerHTML = "";
    state.threads.forEach(t => {
      const div = document.createElement("div");
      div.className = "thread-item" + (t.id === state.activeThreadId ? " active" : "");
      div.dataset.id = t.id;

      const titleSpan = document.createElement("span");
      titleSpan.className = "title";
      titleSpan.textContent = t.title;

      const countSpan = document.createElement("span");
      countSpan.className = "count";
      countSpan.textContent = t.posts.length + "レス";

      div.appendChild(titleSpan);
      div.appendChild(countSpan);

      div.addEventListener("click", () => {
        state.activeThreadId = t.id;
        saveState();
        renderThreadList();
        renderActiveThread();
      });

      threadListEl.appendChild(div);
    });
  }

  // ===== アクティブなスレ表示 =====
  function renderActiveThread() {
    const t = findThread(state.activeThreadId);
    if (!t) {
      threadViewInner.innerHTML = "<p>スレッドが選択されていません。</p>";
      return;
    }

    const wrapper = document.createElement("div");

    const h2 = document.createElement("h2");
    h2.textContent = t.title;
    wrapper.appendChild(h2);

    const meta = document.createElement("div");
    meta.className = "thread-meta";
    meta.textContent = "スレ立て日時: " + formatDate(t.createdAt) +
      " / レス数: " + t.posts.length;
    wrapper.appendChild(meta);

    const postsDiv = document.createElement("div");
    postsDiv.className = "posts";

    t.posts.forEach((p, idx) => {
      const postDiv = document.createElement("div");
      postDiv.className = "post";

      const headerDiv = document.createElement("div");
      headerDiv.className = "post-header";

      const numSpan = document.createElement("span");
      numSpan.className = "num";
      numSpan.textContent = (idx + 1) + " ";

      const nameSpan = document.createElement("span");
      nameSpan.className = "name";
      nameSpan.textContent = p.name || "名無しさん";

      const dateSpan = document.createElement("span");
      dateSpan.className = "date";
      dateSpan.textContent = "  " + formatDate(p.createdAt);

      headerDiv.appendChild(numSpan);
      headerDiv.appendChild(nameSpan);
      headerDiv.appendChild(dateSpan);

      const bodyDiv = document.createElement("div");
      bodyDiv.className = "post-body";
      bodyDiv.textContent = p.body;

      postDiv.appendChild(headerDiv);
      postDiv.appendChild(bodyDiv);

      postsDiv.appendChild(postDiv);
    });

    wrapper.appendChild(postsDiv);

    // 新規レスフォーム
    const newPostDiv = document.createElement("div");
    newPostDiv.className = "new-post";

    const title = document.createElement("strong");
    title.textContent = "新規レス投稿";
    newPostDiv.appendChild(title);

    const nameLabel = document.createElement("label");
    nameLabel.textContent = "名前（省略可：未入力なら「名無しさん」）：";
    const nameInput = document.createElement("input");
    nameInput.type = "text";
    nameInput.placeholder = "名無しさん";
    nameLabel.appendChild(nameInput);
    newPostDiv.appendChild(nameLabel);

    const bodyLabel = document.createElement("label");
    bodyLabel.textContent = "本文：";
    const bodyTextarea = document.createElement("textarea");
    bodyTextarea.placeholder = "本文を入力してください";
    bodyLabel.appendChild(bodyTextarea);
    newPostDiv.appendChild(bodyLabel);

    const btn = document.createElement("button");
    btn.textContent = "書き込む";
    btn.addEventListener("click", () => {
      const body = bodyTextarea.value.trim();
      const name = nameInput.value.trim() || "名無しさん";
      if (!body) {
        alert("本文を入力してください。");
        return;
      }
      t.posts.push({
        name,
        body,
        createdAt: new Date().toISOString()
      });
      saveState();
      renderThreadList();
      renderActiveThread();
    });
    newPostDiv.appendChild(btn);

    const note = document.createElement("div");
    note.className = "notice";
    note.textContent = "※この掲示板はローカル専用です。他の人からは見えません。";
    newPostDiv.appendChild(note);

    wrapper.appendChild(newPostDiv);

    threadViewInner.innerHTML = "";
    threadViewInner.appendChild(wrapper);
  }

  // ===== 新規スレ立て =====
  createThreadBtn.addEventListener("click", () => {
    const title = newThreadTitleEl.value.trim();
    const body = newThreadBodyEl.value.trim();
    if (!title) {
      alert("スレタイを入力してください。");
      return;
    }
    if (!body) {
      alert("本文（1レス目）を入力してください。");
      return;
    }
    const id = "t" + Date.now();

    const newThread = {
      id,
      title,
      createdAt: new Date().toISOString(),
      posts: [
        {
          name: "名無しさん",
          body,
          createdAt: new Date().toISOString()
        }
      ]
    };

    state.threads.unshift(newThread);
    state.activeThreadId = id;
    saveState();
    newThreadTitleEl.value = "";
    newThreadBodyEl.value = "";
    renderThreadList();
    renderActiveThread();
  });

  // ===== 初期化 =====
  loadState();
  renderThreadList();
  renderActiveThread();
</script>

</body>
</html>
